#! /bin/sh /usr/share/dpatch/dpatch-run
## 02_more_verbose_toram.dpatch by  <mika@grml.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Support more verbose version of toram via rsync

@DPATCH@

--- a/scripts/live	Sat Aug 16 11:01:24 2008 +0200
+++ b/scripts/live	Sat Aug 16 11:02:47 2008 +0200
@@ -633,10 +633,21 @@
 	else
 		if [ -n "${MODULETORAMFILE}" ]
 		then
-			cp ${MODULETORAMFILE} ${copyto} # copy only the filesystem module
-		else
-			cp -a ${copyfrom}/* ${copyto}   # "cp -a" from busybox also copies hidden files
-		fi
+                   if [ -x /bin/rsync ] ; then
+                   echo " * Copying $MODULETORAMFILE to RAM" 1>/dev/console
+                      rsync -a --progress ${MODULETORAMFILE} ${copyto} 1>/dev/console # copy only the filesystem module
+                   else
+                      cp ${MODULETORAMFILE} ${copyto} # copy only the filesystem module
+                   fi
+                else
+                   if [ -x /bin/rsync ] ; then
+                   echo " * Copying medium to RAM" 1>/dev/console
+                      rsync -a --progress ${copyfrom}/* ${copyto} 1>/dev/console  # "cp -a" from busybox also copies hidden files
+                   else
+                      cp -a ${copyfrom}/* ${copyto}   # "cp -a" from busybox also copies hidden files
+                   fi
+                fi
+		
 
 		livefs_root
 		umount ${copyfrom}
